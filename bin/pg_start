#!/bin/sh

datadir="${1-$(pwd)}/.local/postgresql"

[ -d "$datadir" ] || (
    mkdir -p "$datadir"
    initdb -D "$datadir" -A trust -E UTF8 -U postgres
)

pg_isready >/dev/null || pg_ctl -w -D "$datadir" -l "$datadir/postgresql.log" start

createuser -U postgres -l -d $USER 2> /dev/null
createdb -U postgres -O $USER $USER 2> /dev/null

psql -U postgres -AtXc "SHOW data_directory"
