#!/bin/sh

: "${PGDATA:?PGDATA must be defined!}"
export PGUSER=postgres

[ -d "$PGDATA" ] || (
    mkdir -p "$PGDATA"
    initdb -D "$PGDATA" -A trust -E UTF8 -U "$PGUSER"
)

pg_isready >/dev/null || pg_ctl -w -D "$PGDATA" -l "$PGDATA/postgresql.log" start

createuser -l $USER 2> /dev/null
createdb -O $USER $USER 2> /dev/null

psql -AtXc "SHOW data_directory"
